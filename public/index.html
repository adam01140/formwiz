<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Waive Court Fees Form</title>
<style>
    select {
        text-align: center;
        width: 200px;
        height: 40px;
        background-color: #64adc4;
        color: white;
        font-size: 16px;
        border-radius: 5px;
        padding-left: 10px;
        border: 1px solid #6B86E7;
        cursor: pointer;
    }
    
    input[type="text"], input[type="email"] {
        text-align: center;
        width: 200px;
        height: 20px;
        font-size: 16px;
        border-radius: 5px;
        padding-left: 10px;
        border: 1px solid #3F59B8;
    }
    
    option {
        background-color: white;
        color: black;
    }

    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        padding: 0px;
        text-align: center;
    }

    button {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        width: 300px;
        height: 40px;
    }

    #userProfile {
        border: 4px solid lightblue;
        border-radius: 10px;
        padding: 20px;
        margin: 10px auto;
        background-color: #ffffff;
        width: 50%;
    }

    .container {
        display: flex;
        justify-content: space-around;
        align-items: start;
        margin-top: 20px;
    }

    #questions {
        border: 4px solid lightblue;
        border-radius: 10px;
        padding: 20px;
        margin: 10px;
        background-color: #ffffff;
        width: 600px;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
    }
	
	#questions2 {
        border: 4px solid white;
        border-radius: 10px;
        padding: 20px;
        margin: 10px;
        background-color: #ffffff;
        width: 250px;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
    }
	
	#box {
        border: 4px solid lightblue;
        border-radius: 10px;
        padding: 20px;
        margin: 10px;
        background-color: #ffffff;
        
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    #userForms {
        border: 4px solid lightblue;
        border-radius: 10px;
        padding: 20px;
        margin: 10px;
        background-color: #ffffff;
        width: 600px;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .next-button {
        background-color: #64adc4;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        margin-top: 10px;
        cursor: pointer;
    }

    .back-button {
        background-color: #64adc4;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        margin-top: 10px;
        cursor: pointer;
    }

    .pdf-container {
        display: flex;
        justify-content: space-around;
        align-items: start;
        margin-top: 20px;
        height: 100%;
        width: 100%;
    }

    #pdfPreview {
        flex: 1;
        border: 2px solid lightblue;
        border-radius: 10px;
        padding: 20px;
        margin: 0px;
        background-color: #ffffff;
        width: 100%;
        height: 750px;
        overflow-y: auto;
        box-sizing: border-box;
        display: none; /* Initially hidden */
    }

    #pdfFrame {
        width: 100%;
        height: 100%;
        border: none;
    }

    .lawyer-info, .job-info, .income-info {
        display: none;
    }

    .checkbox-label {
        display: block;
        text-align: left;
        margin: 0 auto;
        width: 400px;
    }
</style>
</head>
<body>
<center>
<div id="whole">
<h1>Waive Court Fees Form</h1>
<div id="questions">
    <div id="questions1">
        <h1></h1>
		
		
		<div id="box">
		
        <form id="userForm">
            <p><strong>What's your full name?</strong></p>
            <input type="text" id="PetitionerName1[0]" name="PetitionerName1[0]" placeholder="Enter your full name" required>
            <br>
            <p><strong>What's your email?</strong></p>
            <input type="email" id="email" name="email" placeholder="Enter your email" required>
        </form>
        <p><strong>What's your street address?</strong></p>
        <input type="text" id="PetitionerStrAddress[0]" name="PetitionerStrAddress[0]" placeholder="Street">
        <br>
        <input type="text" id="PetitionerCity[0]" name="PetitionerCity[0]" placeholder="City">
        <br>
        <input type="text" id="PetitionerState[0]" name="PetitionerState[0]" placeholder="State">
        <br>
        <input type="text" id="PetitionerZip[0]" name="PetitionerZip[0]" placeholder="Zip"><br>
        <p><strong>What's your phone number?</strong></p>
        <input type="text" id="PetitionerTel[0]" name="PetitionerTel[0]" placeholder="Phone Number"><br>
        </div>
		
		<br><br>
		
		<div id="box">
		<p><strong>Do you have a lawyer?</strong></p>
        <select id="LawyerStatus" name="LawyerStatus" required onchange="toggleLawyerFields()">
            <option value="" disabled selected>Select an option</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
        </select>
        <div class="lawyer-info" id="lawyerInfoFields">
          
		  <br>
            <input type="text" id="LawyerName" name="LawyerName" placeholder="Lawyer's Full Name">
            <br>
            
            <input type="text" id="LawFirm" name="LawFirm" placeholder="Law Firm">
            <br>
            
            <input type="text" id="LawyerAddress" name="LawyerAddress" placeholder="Law Firm Address">
            <br>
            
            <input type="text" id="LawyerPhone" name="LawyerPhone" placeholder="Phone Number">
            <br>
            
            <input type="text" id="LawyerBarNumber" name="LawyerBarNumber" placeholder="State Bar Number">
            
			
			
			<br><br>
            <p><strong>Has your lawyer agreed to advance some of your fees or costs?</strong></p>
            <select id="LawyerAdvance" name="LawyerAdvance" required>
                <option value="" disabled selected>Select an option</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
		</div>
		
		<br><br>
		
		<div id="box">
        <p><strong>Do you have a job?</strong></p>
        <select id="JobStatus" name="JobStatus" required onchange="toggleJobFields()">
            <option value="" disabled selected>Select an option</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
        </select>
        <div class="job-info" id="jobInfoFields">
      <br>
            <input type="text" id="JobTitle" name="JobTitle" placeholder="Job Title">
            <br>

            <input type="text" id="EmployerName" name="EmployerName" placeholder="Name of Employer">
            <br>
 
            <input type="text" id="EmployerAddress" name="EmployerAddress" placeholder="Employer's Address">
            <br>
        </div>
		</div>
		
		<br><br>
		
		<div id="box">
        <p><strong>What court fees would you like waived?</strong></p>
        <select id="CourtType" name="CourtType" required>
            <option value="" disabled selected>Select an option</option>
            <option value="superior">Superior Court</option>
            <option value="supreme">Supreme Court</option>
            <option value="appeal">Court of Appeal</option>
            <option value="appellate_division">Appellate Division of Superior Court</option>
        </select>
        </div>
		
		<br><br>
		
		<div id="box">
        <p><strong>Is your gross monthly household income less than the amount listed: </strong></p>
		<center>
		<img src="gross_monthy.JPG"  width="500" height="70">
		<br><br>
        <select id="LowIncomeStatus" name="LowIncomeStatus" required>
            <option value="" disabled selected>Select an option</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
        </select>
		</div>
		
		<br><br>
		
		<div id="box">
        <p><strong>Do you have enough income to pay for your householdâ€™s basic needs and the court fees?</strong></p>
        <select id="IncomePayStatus" name="IncomePayStatus" required onchange="toggleIncomeFields()">
            <option value="" disabled selected>Select an option</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
        </select>
        <div class="income-info" id="incomeInfoFields">
            <br>
            <p><strong>What would you like the court to do?</strong></p>
            <select id="CourtAction" name="CourtAction" required>
                <option value="" disabled selected>Select an option</option>
                <option value="waive_all">Waive all court fees and costs</option>
                <option value="waive_some">Waive some of the court fees</option>
                <option value="pay_later">Let me make payments over time</option>
            </select>
        </div>
		</div>
		
		<br>
		<center>
        
		<div id="box">
		<div id="questions2">
		
		<p><strong>Do you receive any of these:</strong></p>
        <label class="checkbox-label"><input type="checkbox" name="food_stamps" value="Yes"> Food Stamps</label>
		<label class="checkbox-label"><input type="checkbox" name="supp_sec_inc" value="Yes"> Supp. Sec. Inc.</label>
        <label class="checkbox-label"><input type="checkbox" name="ssp" value="Yes"> SSP</label>
        <label class="checkbox-label"><input type="checkbox" name="medical" value="Yes"> Medi-Cal</label>
        <label class="checkbox-label"><input type="checkbox" name="county_relief" value="Yes"> County Relief/Gen. Assist.</label>
        <label class="checkbox-label"><input type="checkbox" name="calworks" value="Yes"> CalWORKS or Tribal TANF</label>
        <label class="checkbox-label"><input type="checkbox" name="ihss" value="Yes"> IHSS</label>
        <label class="checkbox-label"><input type="checkbox" name="capi" value="Yes"> CAPI</label>
        <label class="checkbox-label"><input type="checkbox" name="wic" value="Yes"> WIC</label>
        <label class="checkbox-label"><input type="checkbox" name="unemployment" value="Yes"> Unemployment</label>
        
		</div>
		</div>
		<button class="next-button" type="button" onclick="editPDF()">Complete Form</button>
   
		
	</div>
</div>
<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
<script>
let uploadedPdfFile = null;

function toggleLawyerFields() {
    const lawyerStatus = document.getElementById('LawyerStatus').value;
    const lawyerInfoFields = document.getElementById('lawyerInfoFields');
    if (lawyerStatus === 'yes') {
        lawyerInfoFields.style.display = 'block';
    } else {
        lawyerInfoFields.style.display = 'none';
    }
}

function toggleJobFields() {
    const jobStatus = document.getElementById('JobStatus').value;
    const jobInfoFields = document.getElementById('jobInfoFields');
    if (jobStatus === 'yes') {
        jobInfoFields.style.display = 'block';
    } else {
        jobInfoFields.style.display = 'none';
    }
}

function toggleIncomeFields() {
    const incomePayStatus = document.getElementById('IncomePayStatus').value;
    const incomeInfoFields = document.getElementById('incomeInfoFields');
    if (incomePayStatus === 'no') {
        incomeInfoFields.style.display = 'block';
    } else {
        incomeInfoFields.style.display = 'none';
    }
}

function downloadPDF() {
    var iframe = document.getElementById('pdfFrame');
    var url = iframe.src;
    var downloadLink = document.createElement("a");
    downloadLink.href = url;
    downloadLink.download = "ModifiedDocument.pdf";
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
}

function loadDefaultPDF() {
    const defaultUrl = 'http://localhost:3000/form.pdf';
    fetch(defaultUrl)
        .then(response => response.blob())
        .then(blob => {
            uploadedPdfFile = blob;
            displayPDF(blob);
        })
        .catch(error => {
            console.error('Error loading default PDF:', error);
            alert('Error loading default PDF: ' + error.message);
        });
}

function displayPDF(pdfBlob) {
    var url = URL.createObjectURL(pdfBlob);
    document.getElementById('pdfFrame').src = url;
    document.getElementById('pdfPreview').style.display = 'block';
}

async function editPDF() {
    if (!uploadedPdfFile) {
        alert('No PDF file is loaded for editing.');
        return;
    }

    // Collect name and email from the form
    const name = document.getElementById('PetitionerName1[0]').value;
    const email = document.getElementById('email').value;
    const lawyerStatus = document.getElementById('LawyerStatus').value;
    const jobStatus = document.getElementById('JobStatus').value;
    const lawyerAdvance = lawyerStatus === 'yes' ? document.getElementById('LawyerAdvance').value : null;
    const courtType = document.getElementById('CourtType').value;
    const lowIncomeStatus = document.getElementById('LowIncomeStatus').value;
    const incomePayStatus = document.getElementById('IncomePayStatus').value;
    const courtAction = document.getElementById('CourtAction').value;

    try {
        const response = await fetch('/addUser', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name, email }),
        });
        const result = await response.text();
        alert(result);
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to add user');
    }

    var formData = new FormData();
    formData.append('pdf', uploadedPdfFile);
    var inputs = document.querySelectorAll('#questions input, #questions select');
    inputs.forEach(input => {
        if (input.type === 'checkbox') {
            formData.append(input.name, input.checked ? 'Yes' : 'No');
        } else {
            formData.append(input.name, input.value);
        }
    });

    if (lowIncomeStatus === 'yes') {
        formData.append('low_gross_income', 'Yes');
    } else {
        formData.append('low_gross_income', 'No');
    }

    if (courtAction === 'waive_all') {
        formData.append('waive_all', 'Yes');
    } else if (courtAction === 'waive_some') {
        formData.append('waive_some', 'Yes');
    } else if (courtAction === 'pay_later') {
        formData.append('pay_later', 'Yes');
    }

    // Append the lawyer status to the form data
    if (lawyerStatus === 'yes') {
        const lawyerName = document.getElementById('LawyerName').value;
        const lawFirm = document.getElementById('LawFirm').value;
        const lawyerAddress = document.getElementById('LawyerAddress').value;
        const lawyerPhone = document.getElementById('LawyerPhone').value;
        const lawyerBarNumber = document.getElementById('LawyerBarNumber').value;
        const lawyerInfo = `My lawyer's name is ${lawyerName}. Their law firm is ${lawFirm}, located at ${lawyerAddress}. Their phone number is ${lawyerPhone} and their state bar number is ${lawyerBarNumber}`;
        formData.append('lawyer_info', lawyerInfo);

        if (lawyerAdvance === 'yes') {
            formData.append('lawyercheckyes', 'Yes');
        } else if (lawyerAdvance === 'no') {
            formData.append('lawyercheckno', 'Yes');
        }
    }

    // Append the job status to the form data
    if (jobStatus === 'yes') {
        const jobTitle = document.getElementById('JobTitle').value;
        const employerName = document.getElementById('EmployerName').value;
        const employerAddress = document.getElementById('EmployerAddress').value;
        formData.append('job_title', jobTitle);
        formData.append('employer_name', employerName);
        formData.append('employer_address', employerAddress);
    }

    // Append the court type to the form data
    if (courtType === 'superior') {
        formData.append('superior_court_checkbox', 'Yes');
    } else if (['supreme', 'appeal', 'appellate_division'].includes(courtType)) {
        formData.append('supreme_court_checkbox', 'Yes');
    }

    // Debugging: Log the form data
    for (var pair of formData.entries()) {
        console.log(pair[0]+ ': ' + pair[1]); 
    }

    fetch('/edit_pdf', {
        method: 'POST',
        body: formData,
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.blob();
        })
        .then(blob => {
            var url = window.URL.createObjectURL(blob);
            document.getElementById('pdfFrame').src = url;
            document.getElementById('pdfPreview').style.display = 'block';
            downloadPDF();
        })
        .catch(error => {
            console.error('Error updating PDF:', error);
            alert('Error updating PDF: ' + error.message);
        });
}

window.onload = function() {
    loadDefaultPDF();
};
</script>
<div id="pdfPreview" style="display:none;">
    <iframe id="pdfFrame"></iframe>
</div>
</div>
</center>
</body>
</html>
